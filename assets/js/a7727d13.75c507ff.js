"use strict";(self.webpackChunkmy_website=self.webpackChunkmy_website||[]).push([[33],{3905:(e,n,r)=>{r.d(n,{Zo:()=>i,kt:()=>m});var t=r(7294);function o(e,n,r){return n in e?Object.defineProperty(e,n,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[n]=r,e}function s(e,n){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var t=Object.getOwnPropertySymbols(e);n&&(t=t.filter((function(n){return Object.getOwnPropertyDescriptor(e,n).enumerable}))),r.push.apply(r,t)}return r}function a(e){for(var n=1;n<arguments.length;n++){var r=null!=arguments[n]?arguments[n]:{};n%2?s(Object(r),!0).forEach((function(n){o(e,n,r[n])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):s(Object(r)).forEach((function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))}))}return e}function l(e,n){if(null==e)return{};var r,t,o=function(e,n){if(null==e)return{};var r,t,o={},s=Object.keys(e);for(t=0;t<s.length;t++)r=s[t],n.indexOf(r)>=0||(o[r]=e[r]);return o}(e,n);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(e);for(t=0;t<s.length;t++)r=s[t],n.indexOf(r)>=0||Object.prototype.propertyIsEnumerable.call(e,r)&&(o[r]=e[r])}return o}var c=t.createContext({}),p=function(e){var n=t.useContext(c),r=n;return e&&(r="function"==typeof e?e(n):a(a({},n),e)),r},i=function(e){var n=p(e.components);return t.createElement(c.Provider,{value:n},e.children)},u={inlineCode:"code",wrapper:function(e){var n=e.children;return t.createElement(t.Fragment,{},n)}},d=t.forwardRef((function(e,n){var r=e.components,o=e.mdxType,s=e.originalType,c=e.parentName,i=l(e,["components","mdxType","originalType","parentName"]),d=p(r),m=o,g=d["".concat(c,".").concat(m)]||d[m]||u[m]||s;return r?t.createElement(g,a(a({ref:n},i),{},{components:r})):t.createElement(g,a({ref:n},i))}));function m(e,n){var r=arguments,o=n&&n.mdxType;if("string"==typeof e||o){var s=r.length,a=new Array(s);a[0]=d;var l={};for(var c in n)hasOwnProperty.call(n,c)&&(l[c]=n[c]);l.originalType=e,l.mdxType="string"==typeof e?e:o,a[1]=l;for(var p=2;p<s;p++)a[p]=r[p];return t.createElement.apply(null,a)}return t.createElement.apply(null,r)}d.displayName="MDXCreateElement"},5690:(e,n,r)=>{r.r(n),r.d(n,{assets:()=>c,contentTitle:()=>a,default:()=>u,frontMatter:()=>s,metadata:()=>l,toc:()=>p});var t=r(7462),o=(r(7294),r(3905));const s={},a="Brew & MongoDB",l={unversionedId:"Brew & MongoDB/index",id:"Brew & MongoDB/index",title:"Brew & MongoDB",description:"\u5b89\u88c5",source:"@site/docs/07-Brew & MongoDB/index.md",sourceDirName:"07-Brew & MongoDB",slug:"/Brew & MongoDB/",permalink:"/m/docs/Brew & MongoDB/",draft:!1,editUrl:"https://github.com/facebook/docusaurus/tree/main/packages/create-docusaurus/templates/shared/docs/07-Brew & MongoDB/index.md",tags:[],version:"current",frontMatter:{},sidebar:"tutorialSidebar",previous:{title:"Docker",permalink:"/m/docs/Docker/"},next:{title:"\u521b\u5efa\u5730\u5740 \u3001\u83b7\u53d6\u5730\u5740\u5217\u8868\u3001\u8be6\u60c5\u3001\u66f4\u65b0\u8def\u7531",permalink:"/m/docs/Brew & MongoDB/\u521b\u5efa\u5730\u5740 \u3001\u83b7\u53d6\u5730\u5740\u5217\u8868\u3001\u8be6\u60c5\u3001\u66f4\u65b0\u8def\u7531"}},c={},p=[{value:"\u5b89\u88c5",id:"\u5b89\u88c5",level:2},{value:"brew\u5207\u6362\u6e90",id:"brew\u5207\u6362\u6e90",level:2},{value:"\u4f7f\u7528brew\u5b89\u88c5mongodb",id:"\u4f7f\u7528brew\u5b89\u88c5mongodb",level:2},{value:"\u542f\u52a8mongodb",id:"\u542f\u52a8mongodb",level:3},{value:"\u505c\u6b62mongodb",id:"\u505c\u6b62mongodb",level:3},{value:"\u4e0b\u8f7dmongodb compass\u56fe\u50cf\u5316\u754c\u9762",id:"\u4e0b\u8f7dmongodb-compass\u56fe\u50cf\u5316\u754c\u9762",level:3},{value:"\u4f7f\u7528mongoose v5\u7248\u672c\u8fde\u63a5\u6570\u636e\u5e93",id:"\u4f7f\u7528mongoose-v5\u7248\u672c\u8fde\u63a5\u6570\u636e\u5e93",level:3},{value:"\u521b\u5efaModels",id:"\u521b\u5efamodels",level:3},{value:"\u6a21\u62df\u521b\u5efa\u7528\u6237",id:"\u6a21\u62df\u521b\u5efa\u7528\u6237",level:3},{value:"\u6ce8\u518c\u63a5\u53e3",id:"\u6ce8\u518c\u63a5\u53e3",level:3},{value:"\u7edf\u4e00\u5904\u7406\u7ed3\u679c\u4fe1\u606f",id:"\u7edf\u4e00\u5904\u7406\u7ed3\u679c\u4fe1\u606f",level:3},{value:"\u767b\u5f55\u63a5\u53e3",id:"\u767b\u5f55\u63a5\u53e3",level:3},{value:"\u521b\u5efa\u5730\u5740",id:"\u521b\u5efa\u5730\u5740",level:3}],i={toc:p};function u(e){let{components:n,...s}=e;return(0,o.kt)("wrapper",(0,t.Z)({},i,s,{components:n,mdxType:"MDXLayout"}),(0,o.kt)("h1",{id:"brew--mongodb"},"Brew & MongoDB"),(0,o.kt)("h2",{id:"\u5b89\u88c5"},"\u5b89\u88c5"),(0,o.kt)("p",null,(0,o.kt)("a",{parentName:"p",href:"https://brew.sh/"},"https://brew.sh/")),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-javascript"},'/bin/bash -c "$(curl -fsSL https://raw.githubusercontent.com/Homebrew/install/HEAD/install.sh)"\n\n')),(0,o.kt)("h2",{id:"brew\u5207\u6362\u6e90"},"brew\u5207\u6362\u6e90"),(0,o.kt)("p",null,(0,o.kt)("a",{parentName:"p",href:"https://lug.ustc.edu.cn/wiki/mirrors/help/brew.git/"},"https://lug.ustc.edu.cn/wiki/mirrors/help/brew.git/")),(0,o.kt)("p",null,(0,o.kt)("a",{parentName:"p",href:"https://www.jianshu.com/p/bea984d27cd2"},"https://www.jianshu.com/p/bea984d27cd2")),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-javascript"},'# \u66ff\u6362brew.git\ncd "$(brew --repo)"\ngit remote set-url origin https://mirrors.tuna.tsinghua.edu.cn/git/homebrew/brew.git\n\n# \u66ff\u6362homebrew-core.git\ncd "$(brew --repo)/Library/Taps/homebrew/homebrew-core"\ngit remote set-url origin https://mirrors.tuna.tsinghua.edu.cn/git/homebrew/homebrew-core.git\n\n# \u5237\u65b0\u6e90\nbrew update\n')),(0,o.kt)("h2",{id:"\u4f7f\u7528brew\u5b89\u88c5mongodb"},"\u4f7f\u7528brew\u5b89\u88c5mongodb"),(0,o.kt)("p",null,"\u73b0\u5728\u5df2\u7ecf\u4e0d\u5f00\u6e90\u4e86\uff0c\u53ea\u80fd\u5b89\u88c5\u4f9b\u5b66\u4e60\u7684mongodb\u793e\u533a\u7248\u672c"),(0,o.kt)("p",null,(0,o.kt)("a",{parentName:"p",href:"https://github.com/mongodb/homebrew-brew"},"https://github.com/mongodb/homebrew-brew")),(0,o.kt)("p",null,"mac\u5982\u4e0b\u5b89\u88c5 windows\u5230\u793e\u533a\u4e0b\u8f7d"),(0,o.kt)("p",null,(0,o.kt)("a",{parentName:"p",href:"https://www.mongodb.com/try/download/community"},"https://www.mongodb.com/try/download/community")),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-javascript"},"// \u7b2c\u4e00\u6b65\nbrew tap mongodb/brew\n// \u7b2c\u4e8c\u6b65\nbrew install mongodb-community\n")),(0,o.kt)("p",null,"\u5b89\u88c5\u597d\u540e\u600e\u4e48\u542f\u52a8\u5462"),(0,o.kt)("h3",{id:"\u542f\u52a8mongodb"},"\u542f\u52a8mongodb"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-\u7eaf\u6587\u672c"},"brew services start mongodb-community\n")),(0,o.kt)("p",null,"\u542f\u52a8\u540e\u4f1a\u63d0\u793asuccess"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-javascript"},"Successfully started `mongodb-community`\n")),(0,o.kt)("p",null,"\u600e\u4e48\u9a8c\u8bc1\u542f\u52a8\u4e86\u5462"),(0,o.kt)("p",null,"\u63a5\u7740\u8f93\u5165 ",(0,o.kt)("inlineCode",{parentName:"p"},"mongo")),(0,o.kt)("p",null,"\u5c31\u4f1a\u8fdb\u5165\u547d\u4ee4\u884c\u6a21\u5f0f"),(0,o.kt)("h3",{id:"\u505c\u6b62mongodb"},"\u505c\u6b62mongodb"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-javascript"},"brew services stop mongodb-community\n")),(0,o.kt)("h3",{id:"\u4e0b\u8f7dmongodb-compass\u56fe\u50cf\u5316\u754c\u9762"},"\u4e0b\u8f7dmongodb compass\u56fe\u50cf\u5316\u754c\u9762"),(0,o.kt)("p",null,"\u5b89\u88c5\u540e\uff0c\u5148\u542f\u52a8mongodb"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-javascript"},"brew services start mongodb-community\n")),(0,o.kt)("p",null,"\u7136\u540ecompass\u5185connect\u540e\u5c31\u4f1a\u51fa\u73b0\u5404\u4e2adatabase, database\u4e0b\u6709collection"),(0,o.kt)("h3",{id:"\u4f7f\u7528mongoose-v5\u7248\u672c\u8fde\u63a5\u6570\u636e\u5e93"},"\u4f7f\u7528mongoose v5\u7248\u672c\u8fde\u63a5\u6570\u636e\u5e93"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-javascript"},'/**\n * @description mongoose \u8fde\u63a5\u6570\u636e\u5e93\n * @auther roc\n */\nconst mongoose = require("mongoose"); // v5\u7248\u672c\n\nconst url = "mongodb://localhost:27017"; // \u672c\u5730\u9ed8\u8ba4\u6570\u636e\u5e93\nconst dbName = "testdb"; // \u6570\u636e\u5e93\u540d\u79f0\n\n// \u914d\u7f6e\nmongoose.set("useCreateIndex", true); // v5\u7248\u672c 6\u7248\u672c\u4f1a\u62a5\u9519\nmongoose.set("useFindAndModify", false);\n\n// \u5f00\u59cb\u8fde\u63a5\nmongoose.connect(`${url}/${dbName}`, {\n  useNewUrlParser: true,\n  useUnifiedTopology: true,\n});\n\n// \u8fde\u63a5\u5bf9\u8c61\nconst db = mongoose.connection;\n\ndb.on("error", (err) => {\n  console.error("mongoose connect error", err);\n});\n\ndb.once("open", () => {\n  console.log("mongoose \u8fde\u63a5\u6210\u529f");\n});\n\nmodule.exports = mongoose;\n\n')),(0,o.kt)("p",null,"\u68c0\u9a8c\u662f\u5426\u8fde\u63a5\u6210\u529f ",(0,o.kt)("inlineCode",{parentName:"p"},"node \u8be5\u6587\u4ef6"),"\uff0c\u6267\u884c\u524d\u9700\u8981\u6267\u884c\u4ee5\u4e0b\u6b65\u9aa4\uff0c\u5426\u5219\u4e0d\u6210\u529f"),(0,o.kt)("ol",null,(0,o.kt)("li",{parentName:"ol"},(0,o.kt)("p",{parentName:"li"},"\u547d\u4ee4\u884c\u542f\u52a8mongodb"),(0,o.kt)("p",{parentName:"li"},(0,o.kt)("inlineCode",{parentName:"p"},"brew services start mongodb-community"))),(0,o.kt)("li",{parentName:"ol"},(0,o.kt)("p",{parentName:"li"},"\u6253\u5f00 MongoDB Compass , connect\u8fde\u63a5"))),(0,o.kt)("h3",{id:"\u521b\u5efamodels"},"\u521b\u5efaModels"),(0,o.kt)("p",null,"\u53ef\u4ee5\u901a\u8fc7\u4ee5\u4e0b\u65b9\u5f0f\u5b9a\u4e49Model\uff0c\u5148\u5b9a\u4e49Schema\uff0c\u7136\u540e\u6839\u636eSchema\u901a\u8fc7mongoose.model()\u751f\u6210Model"),(0,o.kt)("p",null,"user Model"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-javascript"},'// \u5b9a\u4e49\u7528\u6237\u7684Model\nconst mongoose = require("../db/db");\nconst Schema = mongoose.Schema(\n  {\n    username: {\n      type: String,\n      require: true, // \u5fc5\u987b\n      unique: true, // \u552f\u4e00\u4e0d\u53ef\u91cd\u590d\n    },\n    password: String,\n  },\n  {\n    timestamps: true,\n  }\n);\n\nconst User = mongoose.model("user", Schema);\n\nmodule.exports = User;\n')),(0,o.kt)("p",null,"address Model"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-javascript"},'const mongoose = require("../db/db");\nconst Schema = mongoose.Schema(\n  {\n    username: {\n      type: String,\n      require: true, // \u5fc5\u987b\n    },\n    city: String,\n    department: String,\n    houseNumber: String,\n    name: String,\n    phone: String,\n  },\n  {\n    timestamps: true,\n  }\n);\nconst Address = mongoose.model("address", Schema);\nmodule.exports = Address;\n')),(0,o.kt)("p",null,"\u5546\u5e97 model"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-javascript"},'const Schema = mongoose.Schema(\n  {\n    name: String,\n    imgUrl: String,\n    sales: Number,\n    expressLimit: {\n      type: Number,\n      default: 0,\n    },\n    expressPrice: Number,\n    slogan: String,\n  },\n  {\n    timestamps: true,\n  }\n);\n\nconst Shop = mongoose.model("shop", Schema);\n\nmodule.exports = Shop;\n')),(0,o.kt)("p",null,"\u5546\u54c1 Model"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-javascript"},"const mongoose = require(\"../db/db\");\n\nconst Schema = mongoose.Schema(\n  {\n    shopId: {\n      type: String,\n      require: true,\n    },\n    name: String,\n    imgUrl: String,\n    sales: Number,\n    price: Number,\n    oldPrice: Number,\n    //   \u4fa7\u8fb9\u7684tabs \u89c4\u5b9a\u6b64\u5546\u54c1\u5c5e\u4e8e\u54ea\u4e2atab\n    tabs: [String], // ['all', 'kill']\n  },\n  {\n    timestamps: true,\n  }\n);\n\nconst Product = mongoose.model(\"product\", Schema);\n\nmodule.exports = Product;\n")),(0,o.kt)("h3",{id:"\u6a21\u62df\u521b\u5efa\u7528\u6237"},"\u6a21\u62df\u521b\u5efa\u7528\u6237"),(0,o.kt)("p",null,"\u5728db\u76ee\u5f55\u4e0b\u65b0\u5efatest.sj\u6587\u4ef6"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-javascript"},'const User = require("../../models/User");\n\n!(async () => {\n  // \u521b\u5efa\u4e00\u4e2a\u7528\u6237\n  //   await User.create({\n  //     username: "roc",\n  //     password: "123456",\n  //   });\n\n  //   \u5728\u521b\u5efa\u4e00\u4e2a\u7528\u6237\n  //   await User.create({\n  //     username: "peng",\n  //     password: "456",\n  //   });\n\n  const roc = await User.findOne({\n    username: "roc",\n    password: "123456",\n  });\n\n  console.log("\u67e5\u8be2\u7ed3\u679c", roc);\n})();\n')),(0,o.kt)("p",null,"User.create()\u53ef\u4ee5\u521b\u5efa\u4e00\u4e2a\u7528\u6237\uff0cUser.findOne\u662f\u67e5\u627e\u7528\u6237\uff0c\u521b\u5efa\u548c\u67e5\u627e\u7ed3\u679c\u5982\u4e0b"),(0,o.kt)("p",null,"\u521b\u5efa\u7ed3\u679c"),(0,o.kt)("p",null,(0,o.kt)("img",{src:r(228).Z,width:"1272",height:"1072"})),(0,o.kt)("p",null,"\u67e5\u627e\u7ed3\u679c"),(0,o.kt)("p",null,(0,o.kt)("img",{src:r(1368).Z,width:"744",height:"454"})),(0,o.kt)("h3",{id:"\u6ce8\u518c\u63a5\u53e3"},"\u6ce8\u518c\u63a5\u53e3"),(0,o.kt)("p",null,"\u9996\u5148\u5728",(0,o.kt)("inlineCode",{parentName:"p"},"src/controller"),"\u4e0b\u65b0\u5efa\u7528\u6237\u76f8\u5173\u7684\u64cd\u4f5c\u6587\u4ef6",(0,o.kt)("inlineCode",{parentName:"p"},"user.js")," ,\u5185\u5bb9\u5982\u4e0b"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-javascript"},'const User = require("../models/User");\n/**\n *\u6ce8\u518c\n * @param {string} username \u7528\u6237\u540d\n * @param {string} password \u5bc6\u7801\n * @returns \u521b\u5efa\u7ed3\u679c\n */\nasync function register(username, password) {\n  const newUser = await User.create({\n    username,\n    password,\n  });\n  return newUser;\n}\n\nmodule.exports = {\n  register\n};\n\n')),(0,o.kt)("p",null,"controller\u4e3b\u8981\u662f\u64cd\u4f5c\u6570\u636e\u5e93\uff0c\u90a3\u4e48\u5728\u54ea\u91cc\u8c03\u63a5\u53e3\u5462\uff0c\u662f\u5728",(0,o.kt)("inlineCode",{parentName:"p"},"src/routes/users.js")," ,\u5728\u8fd9\u91cc\u5b9a\u4e49\u6ce8\u518c\u767b\u5f55\u7b49\u63a5\u53e3\uff0c\u5148\u6765\u5199\u6ce8\u518c\u63a5\u53e3"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-javascript"},'const router = require("koa-router")();\nconst { register } = require("../controller/user");\n\nrouter.prefix("/api/user"); // \u8def\u7531\u524d\u7f00\n\n// \u6ce8\u518c\nrouter.post("/register", async function (ctx, next) {\n  const { username, password } = ctx.request.body;\n  try {\n    const newUser = await register(username, password);\n     ctx.body = {\n      error: 0, // \u6210\u529f\n      data: newUser,\n    };\n  } catch (error) {\n    console.error(error);\n    ctx.body = {\n      error: 10001,\n      message: "\u521b\u5efa\u5931\u8d25- " + error.message,\n    };\n  }\n});\n')),(0,o.kt)("p",null,"\u5b8c\u6574\u6ce8\u518c\u5730\u5740\u4e3a ",(0,o.kt)("inlineCode",{parentName:"p"},"/api/user/register")," ,\u65b9\u6cd5\u4e3apost, \u5f53\u6ce8\u518c\u65f6\uff0c\u4f1a\u8c03\u7528controller\u4e2d\u7684register\u65b9\u6cd5\uff0c\u4f1a\u901a\u8fc7User.create()\u65b9\u6cd5\u53bb\u521b\u5efa\u8fd9\u4e2a\u7528\u6237\uff0c \u8fd4\u56de\u521b\u5efa\u7ed3\u679c\uff0c\u7136\u540eawait \u62ff\u5230\u6ce8\u518c\u7ed3\u679c\uff0c\u901a\u8fc7ctx.body \u8fd4\u56de\u7ed9\u524d\u7aef\u3002"),(0,o.kt)("p",null,"\u95ee\u9898\uff1a\u8fd9\u6837\u8fd4\u56de\u6210\u529f\u6216\u9519\u8bef\u4fe1\u606f\u4f1a\u5f88\u7e41\u7410\uff0c\u6bcf\u6b21\u90fd\u5f97\u624b\u52a8\u5199\uff0c\u4ee5\u540e\u4e5f\u4e0d\u597d\u7ef4\u62a4\uff0c\u6240\u4ee5\u5148\u5b9a\u4e49\u597d\u6210\u529f\u548c\u5931\u8d25\u7684\u9519\u8bef\u4fe1\u606f\uff0c\u7edf\u4e00\u5904\u7406"),(0,o.kt)("h3",{id:"\u7edf\u4e00\u5904\u7406\u7ed3\u679c\u4fe1\u606f"},"\u7edf\u4e00\u5904\u7406\u7ed3\u679c\u4fe1\u606f"),(0,o.kt)("p",null,"\u5728 ",(0,o.kt)("inlineCode",{parentName:"p"},"src/res-models")," \u4e0b\u65b0\u5efa ",(0,o.kt)("inlineCode",{parentName:"p"},"SuccessModel.js")," \u6587\u4ef6\u548c ",(0,o.kt)("inlineCode",{parentName:"p"},"ErrorModel.js")," \u6587\u4ef6\uff0c\u5206\u522b\u5982\u4e0b"),(0,o.kt)("p",null,"\u6210\u529f\u7684class"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-javascript"},"class SuccessModel {\n  constructor(data) {\n    this.errno = 0;\n    if (data !== null) this.data = data;\n  }\n}\n\nmodule.exports = SuccessModel;\n")),(0,o.kt)("p",null,"\u5931\u8d25\u7684class"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-javascript"},'class ErrorModel {\n  constructor(error = -1, message = "error") {\n    this.errno = error;\n    this.message = message;\n  }\n}\n\nmodule.exports = ErrorModel;\n')),(0,o.kt)("p",null,"\u6210\u529f\u53ef\u4ee5\u9009\u62e9\u662f\u5426\u8fd4\u56dedata\uff0c\u5931\u8d25\u4f1a\u8fd4\u56deerror\u548cmessage"),(0,o.kt)("p",null,"\u6709\u4e86\u8fd9\u4e24\u4e2a\u7c7b\uff0c\u5c31\u53ef\u4ee5\u5b8c\u5584\u4e0b\u4e4b\u524d\u7684\u6ce8\u518c\u63a5\u53e3\u4e86"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-javascript"},'const { ErrorModel, SuccessModel } = require("../res-model/index");\n\nrouter.post("/register", async function (ctx, next) {\n  const { username, password } = ctx.request.body;\n  try {\n    const newUser = await register(username, password);\n    ctx.body = new SuccessModel(newUser);\n  } catch (error) {\n    console.error(error);\n    ctx.body = new ErrorModel(10001, "\u6ce8\u518c\u5931\u8d25- " + error.message);\n  }\n});\n')),(0,o.kt)("p",null,"\u542f\u52a8\u7a0b\u5e8f\uff0c\u6253\u5f00postman \u8fdb\u884c\u6d4b\u8bd5\uff0c\u7ed3\u679c\u5982\u4e0b"),(0,o.kt)("p",null,(0,o.kt)("img",{src:r(7624).Z,width:"1804",height:"1276"})),(0,o.kt)("p",null,"\u901a\u8fc7post\u4f20\u7ed9koa json\u7684\u6570\u636e\uff0c\u4f1a\u8fd4\u56de\u6ce8\u518c\u540e\u7684\u4fe1\u606f\uff0c\u5982\u679c\u540c\u6837\u7684\u4fe1\u606f\uff0c\u518d\u6b21\u6ce8\u518c\u5c31\u4f1a\u662f\u5982\u4e0b\u7ed3\u679c\u4e86\uff0c\u63d0\u793a\u6ce8\u518c\u5931\u8d25"),(0,o.kt)("p",null,(0,o.kt)("img",{src:r(1634).Z,width:"1798",height:"394"})),(0,o.kt)("h3",{id:"\u767b\u5f55\u63a5\u53e3"},"\u767b\u5f55\u63a5\u53e3"),(0,o.kt)("p",null,"\u6709\u4e86\u4e0a\u9762\u7684\u94fa\u57ab\uff0c\u767b\u5f55\u5c31\u5bb9\u6613\u591a\u4e86 \uff0c \u6570\u636e\u5e93\u76f8\u5173\u7684\u653e\u5728controller/user.js\u4e2d"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-javascript"},"/**\n *\u767b\u5f55\n * @param {string} username \u7528\u6237\u540d\n * @param {string} password \u5bc6\u7801\n * @returns \u67e5\u8be2\u7ed3\u679c\n */\nasync function login(username, password) {\n  const user = await User.findOne({\n    username,\n    password,\n  });\n  return user != null ? true : false;\n}\n")),(0,o.kt)("p",null,"\u63a5\u53e3\u903b\u8f91\u5199\u5728\u548c\u6ce8\u518c\u4e00\u4e2a\u6587\u4ef6\u91cc ",(0,o.kt)("inlineCode",{parentName:"p"},"src/routes/users.js")),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-javascript"},'// \u767b\u5f55\nrouter.post("/login", async function (ctx, next) {\n  const { username, password } = ctx.request.body;\n  console.log("** --- result --- **", username); // wsp-log\n  const result = await login(username, password);\n  if (result) {\n    ctx.session.userInfo = { username };\n    ctx.body = new SuccessModel();\n  } else {\n    ctx.body = new ErrorModel(10002, "\u767b\u5f55\u5931\u8d25- ");\n  }\n});\n')),(0,o.kt)("p",null,"\u4e0b\u9762\u5206\u522b\u6d4b\u8bd5\u767b\u5f55\u6210\u529f\u548c\u5931\u8d25\u7684\u7ed3\u679c"),(0,o.kt)("p",null,"\u6210\u529f"),(0,o.kt)("p",null,(0,o.kt)("img",{src:r(956).Z,width:"1326",height:"848"})),(0,o.kt)("p",null,"\u5931\u8d25"),(0,o.kt)("p",null,(0,o.kt)("img",{src:r(7714).Z,width:"1390",height:"890"})),(0,o.kt)("p",null,"\u5931\u8d25\u7684\u662fusername\u591a\u4e86\u4e2a1\uff0c\u6240\u4ee5\u4f1a\u8fd4\u56de\u767b\u5f55\u5931\u8d25"),(0,o.kt)("h3",{id:"\u521b\u5efa\u5730\u5740"},"\u521b\u5efa\u5730\u5740"),(0,o.kt)("p",null,"\u521b\u5efa\u5730\u5740\u9700\u8981\u767b\u5f55\u4eba\u5728\u767b\u5f55\u72b6\u6001\uff0c\u6240\u4ee5\u9700\u8981\u6821\u9a8c\u767b\u5f55\u72b6\u6001\uff0c\u7531\u4e8e\u767b\u5f55\u540e\u4f1a\u8fd4\u56de\u7ed9\u524d\u7aef\u7528\u6237\u4fe1\u606f ",(0,o.kt)("inlineCode",{parentName:"p"},"ctx.session.userInfo = { username };")," \uff0c\u6240\u4ee5\u521b\u5efa\u5730\u5740\u53ef\u4ee5\u62ff\u5230\u7528\u6237\u4fe1\u606f\u3002"),(0,o.kt)("p",null,"\u5730\u5740\u7684\u903b\u8f91"),(0,o.kt)("p",null,"\u5730\u5740controller"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-javascript"},'const Address = require("../models/Address");\n\n/**\n * \u521b\u5efa\u5730\u5740\n * @param {string} username \u7528\u6237\u540d\n * @param {Object} data \u5730\u5740\u4fe1\u606f\n * @returns \u65b0\u7684\u5730\u5740\n */\nasync function createAddress(username, data) {\n  const address = await Address.create({\n    username,\n    ...data,\n  });\n  return address;\n}\n')),(0,o.kt)("p",null,"\u521b\u5efa\u5730\u5740api"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-javascript"},'router.prefix("/api/user/address");\n\n// \u521b\u5efa\u6536\u8d27\u5730\u5740 loginCheck \u662f\u767b\u5f55\u6821\u9a8c \u53ea\u6709\u767b\u5f55\u4e86\u624d\u53ef\u4ee5\u521b\u5efa\nrouter.post("/", loginCheck, async (ctx, next) => {\n  const userInfo = ctx.session.userInfo;\n  const data = ctx.request.body;\n\n  try {\n    const newAddress = await createAddress(userInfo.username, data);\n    ctx.body = new SuccessModel(newAddress);\n  } catch (error) {\n    console.error(error);\n    ctx.body = new ErrorModel(10003, "\u521b\u5efa\u5730\u5740\u5931\u8d25");\n  }\n});\n')),(0,o.kt)("p",null,"\u53ef\u4ee5\u53d1\u73b0\uff0cpost\u7684\u7b2c\u4e8c\u4e2a\u53c2\u6570\u662floginCheck\uff0c\u7528\u6765\u505a\u767b\u5f55\u6821\u9a8c\uff0c\u4ed6\u662f\u4e00\u4e2a\u4e2d\u95f4\u4ef6 \u5728",(0,o.kt)("inlineCode",{parentName:"p"},"middleware/logincheck.js")," \uff0c\u5185\u5bb9\u5982\u4e0b"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-javascript"},'/**\n * \u767b\u5f55\u9a8c\u8bc1\u4e2d\u95f4\u4ef6\n */\nconst { ErrorModel } = require("../res-model/index");\nmodule.exports = async (ctx, next) => {\n  const session = ctx.session;\n  if (session && session.userInfo) {\n    await next();\n    return;\n  } else {\n    ctx.body = new ErrorModel(10003, "session\u4e0d\u5b58\u5728");\n  }\n};\n\n')),(0,o.kt)("p",null,"\u5982\u679c\u6ca1\u6709session\u4fe1\u606f\uff0c\u5c31\u4f1a\u8fd4\u56de\u767b\u5f55\u4e0d\u5b58\u5728"),(0,o.kt)("p",null,"\u4ee5\u4e0a\u5c31\u662f\u521b\u5efa\u5730\u5740\u7684\u6d41\u7a0b\uff0c\u903b\u8f91\u5199\u5b8c\uff0c\u522b\u5fd8\u4e86\u5728\u5165\u53e3\u6587\u4ef6app.js\u4e2d\u5f15\u5165\uff0c\u5e76\u6ce8\u518c\u8def\u7531\u4fe1\u606f"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-javascript"},'const address = require("./routes/address");\n\napp.use(address.routes(), address.allowedMethods());\n\n')),(0,o.kt)("p",null,(0,o.kt)("a",{parentName:"p",href:"https://www.wolai.com/5BcTgDLEjdwd8wiS2UytTW",title:"\u521b\u5efa\u5730\u5740 \u3001\u83b7\u53d6\u5730\u5740\u5217\u8868\u3001\u8be6\u60c5\u3001\u66f4\u65b0\u8def\u7531"},"\u521b\u5efa\u5730\u5740 \u3001\u83b7\u53d6\u5730\u5740\u5217\u8868\u3001\u8be6\u60c5\u3001\u66f4\u65b0\u8def\u7531")))}u.isMDXComponent=!0},7714:(e,n,r)=>{r.d(n,{Z:()=>t});const t=r.p+"assets/images/image_8Dcf7644Vd-637d070cfc11e180dfb362a7ea5c8014.png"},228:(e,n,r)=>{r.d(n,{Z:()=>t});const t=r.p+"assets/images/image_GdqTmiQ7h6-4ea4ec6bf85be7d0656b631bcb49354c.png"},956:(e,n,r)=>{r.d(n,{Z:()=>t});const t=r.p+"assets/images/image_OlwX-fljT4-0b6217e954accc0692fce8348c1d1d33.png"},7624:(e,n,r)=>{r.d(n,{Z:()=>t});const t=r.p+"assets/images/image_PKgp77ShbZ-bf4146c8dd5e3d3c6f20ea8f6b691f85.png"},1634:(e,n,r)=>{r.d(n,{Z:()=>t});const t=r.p+"assets/images/image_XVW48Go1BM-7a3b2bc4711c4b4f79a5551cb24ac11f.png"},1368:(e,n,r)=>{r.d(n,{Z:()=>t});const t=r.p+"assets/images/image_rleaBLR3Lh-7271b933ef102c1d688f3619eaee375b.png"}}]);