"use strict";(self.webpackChunkmy_website=self.webpackChunkmy_website||[]).push([[5024],{3905:(e,n,r)=>{r.d(n,{Zo:()=>u,kt:()=>m});var t=r(7294);function s(e,n,r){return n in e?Object.defineProperty(e,n,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[n]=r,e}function a(e,n){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var t=Object.getOwnPropertySymbols(e);n&&(t=t.filter((function(n){return Object.getOwnPropertyDescriptor(e,n).enumerable}))),r.push.apply(r,t)}return r}function o(e){for(var n=1;n<arguments.length;n++){var r=null!=arguments[n]?arguments[n]:{};n%2?a(Object(r),!0).forEach((function(n){s(e,n,r[n])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):a(Object(r)).forEach((function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))}))}return e}function d(e,n){if(null==e)return{};var r,t,s=function(e,n){if(null==e)return{};var r,t,s={},a=Object.keys(e);for(t=0;t<a.length;t++)r=a[t],n.indexOf(r)>=0||(s[r]=e[r]);return s}(e,n);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);for(t=0;t<a.length;t++)r=a[t],n.indexOf(r)>=0||Object.prototype.propertyIsEnumerable.call(e,r)&&(s[r]=e[r])}return s}var c=t.createContext({}),i=function(e){var n=t.useContext(c),r=n;return e&&(r="function"==typeof e?e(n):o(o({},n),e)),r},u=function(e){var n=i(e.components);return t.createElement(c.Provider,{value:n},e.children)},l={inlineCode:"code",wrapper:function(e){var n=e.children;return t.createElement(t.Fragment,{},n)}},p=t.forwardRef((function(e,n){var r=e.components,s=e.mdxType,a=e.originalType,c=e.parentName,u=d(e,["components","mdxType","originalType","parentName"]),p=i(r),m=s,f=p["".concat(c,".").concat(m)]||p[m]||l[m]||a;return r?t.createElement(f,o(o({ref:n},u),{},{components:r})):t.createElement(f,o({ref:n},u))}));function m(e,n){var r=arguments,s=n&&n.mdxType;if("string"==typeof e||s){var a=r.length,o=new Array(a);o[0]=p;var d={};for(var c in n)hasOwnProperty.call(n,c)&&(d[c]=n[c]);d.originalType=e,d.mdxType="string"==typeof e?e:s,o[1]=d;for(var i=2;i<a;i++)o[i]=r[i];return t.createElement.apply(null,o)}return t.createElement.apply(null,r)}p.displayName="MDXCreateElement"},3504:(e,n,r)=>{r.r(n),r.d(n,{assets:()=>c,contentTitle:()=>o,default:()=>l,frontMatter:()=>a,metadata:()=>d,toc:()=>i});var t=r(7462),s=(r(7294),r(3905));const a={},o="\u521b\u5efa\u5730\u5740 \u3001\u83b7\u53d6\u5730\u5740\u5217\u8868\u3001\u8be6\u60c5\u3001\u66f4\u65b0\u8def\u7531",d={unversionedId:"Brew & MongoDB/\u521b\u5efa\u5730\u5740 \u3001\u83b7\u53d6\u5730\u5740\u5217\u8868\u3001\u8be6\u60c5\u3001\u66f4\u65b0\u8def\u7531",id:"Brew & MongoDB/\u521b\u5efa\u5730\u5740 \u3001\u83b7\u53d6\u5730\u5740\u5217\u8868\u3001\u8be6\u60c5\u3001\u66f4\u65b0\u8def\u7531",title:"\u521b\u5efa\u5730\u5740 \u3001\u83b7\u53d6\u5730\u5740\u5217\u8868\u3001\u8be6\u60c5\u3001\u66f4\u65b0\u8def\u7531",description:"controller/address.js",source:"@site/docs/07-Brew & MongoDB/\u521b\u5efa\u5730\u5740 \u3001\u83b7\u53d6\u5730\u5740\u5217\u8868\u3001\u8be6\u60c5\u3001\u66f4\u65b0\u8def\u7531.md",sourceDirName:"07-Brew & MongoDB",slug:"/Brew & MongoDB/\u521b\u5efa\u5730\u5740 \u3001\u83b7\u53d6\u5730\u5740\u5217\u8868\u3001\u8be6\u60c5\u3001\u66f4\u65b0\u8def\u7531",permalink:"/m/docs/Brew & MongoDB/\u521b\u5efa\u5730\u5740 \u3001\u83b7\u53d6\u5730\u5740\u5217\u8868\u3001\u8be6\u60c5\u3001\u66f4\u65b0\u8def\u7531",draft:!1,editUrl:"https://github.com/facebook/docusaurus/tree/main/packages/create-docusaurus/templates/shared/docs/07-Brew & MongoDB/\u521b\u5efa\u5730\u5740 \u3001\u83b7\u53d6\u5730\u5740\u5217\u8868\u3001\u8be6\u60c5\u3001\u66f4\u65b0\u8def\u7531.md",tags:[],version:"current",frontMatter:{},sidebar:"tutorialSidebar",previous:{title:"Brew & MongoDB",permalink:"/m/docs/Brew & MongoDB/"},next:{title:"Parallels \u5b89\u88c5window10",permalink:"/m/docs/Parallels \u5b89\u88c5window10/Parallels \u5b89\u88c5window10"}},c={},i=[{value:"controller/address.js",id:"controlleraddressjs",level:2},{value:"\u8def\u7531\u4fe1\u606f routes/address.js",id:"\u8def\u7531\u4fe1\u606f-routesaddressjs",level:2}],u={toc:i};function l(e){let{components:n,...r}=e;return(0,s.kt)("wrapper",(0,t.Z)({},u,r,{components:n,mdxType:"MDXLayout"}),(0,s.kt)("h1",{id:"\u521b\u5efa\u5730\u5740-\u83b7\u53d6\u5730\u5740\u5217\u8868\u8be6\u60c5\u66f4\u65b0\u8def\u7531"},"\u521b\u5efa\u5730\u5740 \u3001\u83b7\u53d6\u5730\u5740\u5217\u8868\u3001\u8be6\u60c5\u3001\u66f4\u65b0\u8def\u7531"),(0,s.kt)("h2",{id:"controlleraddressjs"},"controller/address.js"),(0,s.kt)("pre",null,(0,s.kt)("code",{parentName:"pre",className:"language-javascript"},'/**\n * address controller\n */\n\nconst Address = require("../models/Address");\n\n/**\n * \u521b\u5efa\u5730\u5740\n * @param {string} username \u7528\u6237\u540d\n * @param {Object} data \u5730\u5740\u4fe1\u606f\n * @returns \u65b0\u7684\u5730\u5740\n */\nasync function createAddress(username, data) {\n  const address = await Address.create({\n    username,\n    ...data,\n  });\n  return address;\n}\n\n/**\n * \u83b7\u53d6\u5730\u5740\u5217\u8868\n * @param {string} username \u7528\u6237\u540d\n * @returns \u65b0\u7684\u5730\u5740\n */\nasync function getAddressList(username) {\n  const list = await Address.find({\n    username,\n  }).sort({ updatedAt: -1 }); // \u5012\u5e8f\u6392\u5e8f\n  return list;\n}\n\n/**\n * \u83b7\u53d6\u5355\u4e2a\u5730\u5740\n * @param {string} id \u5730\u5740id\n * @returns \u65b0\u7684\u5730\u5740\n */\nasync function getAddressDetail(id, username) {\n  const address = await Address.findOne({ _id: id, username });\n  return address;\n}\n\n/**\n * \u66f4\u65b0\u5730\u5740\u4fe1\u606f\n * @param {string} id \u5730\u5740id\n * @param {string} username \u7528\u6237\u540d\n * @param {Object} data \u65b0\u7684\u6536\u8d27\u4fe1\u606f\n * @returns \u7ed3\u679c\n */\nasync function updateAddress(id, username, data) {\n  const address = await Address.findOneAndUpdate(\n    { _id: id, username },\n    { ...data, username },\n    {\n      new: true,\n    }\n  );\n  return address;\n}\n\nmodule.exports = {\n  createAddress,\n  getAddressList,\n  getAddressDetail,\n  updateAddress,\n};\n\n')),(0,s.kt)("h2",{id:"\u8def\u7531\u4fe1\u606f-routesaddressjs"},"\u8def\u7531\u4fe1\u606f routes/address.js"),(0,s.kt)("pre",null,(0,s.kt)("code",{parentName:"pre",className:"language-javascript"},'/**\n * \u5730\u5740\n */\n\nconst router = require("koa-router")();\nconst {\n  createAddress,\n  getAddressList,\n  getAddressDetail,\n  updateAddress,\n} = require("../controller/address");\nconst loginCheck = require("../middleware/loginCheck");\nconst { ErrorModel, SuccessModel } = require("../res-model/index");\n\nrouter.prefix("/api/user/address");\n\n// \u521b\u5efa\u6536\u8d27\u5730\u5740 loginCheck \u662f\u767b\u5f55\u6821\u9a8c \u53ea\u6709\u767b\u5f55\u4e86\u624d\u53ef\u4ee5\u521b\u5efa\nrouter.post("/", loginCheck, async (ctx, next) => {\n  const userInfo = ctx.session.userInfo;\n  const data = ctx.request.body;\n\n  try {\n    const newAddress = await createAddress(userInfo.username, data);\n    ctx.body = new SuccessModel(newAddress);\n  } catch (error) {\n    console.error(error);\n    ctx.body = new ErrorModel(10003, "\u521b\u5efa\u5730\u5740\u5931\u8d25");\n  }\n});\n\n// \u83b7\u53d6\u6536\u8d27\u5730\u5740\u5217\u8868\nrouter.get("/", loginCheck, async (ctx, next) => {\n  const userInfo = ctx.session.userInfo;\n  const { username } = userInfo;\n\n  const list = await getAddressList(username);\n  ctx.body = new SuccessModel(list);\n});\n\n// \u83b7\u53d6\u5355\u4e2a\u6536\u8d27\u5730\u5740 \u52a8\u6001id\n// api/user/address/:id\nrouter.get("/:addressId", loginCheck, async (ctx, next) => {\n  const userInfo = ctx.session.userInfo;\n  const { username } = userInfo;\n\n  const addressId = ctx.params.addressId;\n\n  // \u83b7\u53d6\u5730\u5740\u9700\u8981\u7528\u6237\u540d\u548c\u5730\u5740id\u5bf9\u5e94\u4e0a\uff0c \u5982\u679c\u767b\u5f55\u7684\u662f\u53e6\u4e00\u4e2a\u4eba\uff0c\u4f20\u53e6\u4e00\u4eba\u7684\u5730\u5740id\uff0c\u4e5f\u4f1a\u83b7\u53d6\u5230\n  const detail = await getAddressDetail(addressId, username);\n  ctx.body = new SuccessModel(detail || []);\n});\n\n// \u66f4\u65b0\u5355\u4e2a\u6536\u8d27\u5730\u5740\nrouter.patch("/:addressId", loginCheck, async (ctx, next) => {\n  const id = ctx.params.addressId;\n  const data = ctx.request.body;\n\n  const userInfo = ctx.session.userInfo;\n  const { username } = userInfo;\n\n  const newAddress = await updateAddress(id, username, data);\n  ctx.body = new SuccessModel(newAddress);\n});\n\nmodule.exports = router;\n\n')))}l.isMDXComponent=!0}}]);